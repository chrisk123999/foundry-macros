{
  "type": "spell",
  "system": {
    "description": {
      "value": "<p>You create a 20-foot-radius sphere of poisonous, yellow-green fog centered on a point you choose within range. The fog spreads around corners. It lasts for the duration or until strong wind disperses the fog, ending the spell. Its area is heavily obscured.</p>\n<p>When a creature enters the spell's area for the first time on a turn or starts its turn there, that creature must make a Constitution saving throw. The creature takes 5d8 poison damage on a failed save, or half as much damage on a successful one. Creatures are affected even if they hold their breath or don't need to breathe.</p>\n<p>The fog moves 10 feet away from you at the start of each of your turns, rolling along the surface of the ground. The vapors, being heavier than air, sink to the lowest level of the land, even pouring down openings.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 6th level or higher, the damage increases by 1d8 for each slot level above 5th.</p>",
      "chat": "",
      "unidentified": ""
    },
    "source": "Basic Rules, Player's Handbook pg 222",
    "activation": {
      "type": "action",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": 10,
      "units": "minute"
    },
    "target": {
      "value": 20,
      "width": null,
      "units": "ft",
      "type": "sphere"
    },
    "range": {
      "value": 120,
      "long": null,
      "units": "ft"
    },
    "uses": {
      "value": null,
      "max": "",
      "per": "",
      "recovery": ""
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": "",
    "actionType": "other",
    "attackBonus": 0,
    "chatFlavor": "",
    "critical": {
      "threshold": null,
      "damage": ""
    },
    "damage": {
      "parts": [
        [
          "0",
          "poison"
        ]
      ],
      "versatile": "",
      "value": ""
    },
    "formula": "",
    "save": {
      "ability": "",
      "dc": null,
      "scaling": "spell"
    },
    "level": 5,
    "school": "con",
    "components": {
      "value": "",
      "vocal": true,
      "somatic": true,
      "material": false,
      "ritual": false,
      "concentration": true
    },
    "materials": {
      "value": "",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": true
    },
    "scaling": {
      "mode": "level",
      "formula": "1d8"
    }
  },
  "name": "Cloudkill",
  "flags": {
    "ddbimporter": {
      "id": 136226,
      "definitionId": 2030,
      "entityTypeId": 435869154,
      "dndbeyond": {
        "lookup": "classSpell",
        "class": "Wizard",
        "level": 20,
        "characterClassId": 116821711,
        "spellLevel": 5,
        "ability": "int",
        "mod": 5,
        "dc": 19,
        "cantripBoost": false,
        "overrideDC": false,
        "id": 136226,
        "entityTypeId": 435869154,
        "healingBoost": 0,
        "usesSpellSlot": true
      },
      "originalName": "Cloudkill",
      "sources": [
        {
          "sourceId": 1,
          "pageNumber": null,
          "sourceType": 2
        },
        {
          "sourceId": 2,
          "pageNumber": 222,
          "sourceType": 1
        }
      ],
      "tags": [
        "Damage"
      ],
      "version": "3.1.23",
      "effectsApplied": true,
      "importId": "TFMXddyn3Tv0WVyp",
      "effect": {
        "dice": "5d8[poison]",
        "damageType": "poison",
        "save": "con",
        "sequencerFile": "jb2a.fog_cloud.2.green"
      }
    },
    "spell-class-filter-for-5e": {
      "parentClass": "wizard"
    },
    "itemacro": {
      "macro": {
        "data": {
          "name": "Cloudkill",
          "type": "script",
          "scope": "global",
          "command": ""
        },
        "options": {},
        "apps": {},
        "compendium": null,
        "name": "Cloudkill",
        "type": "script",
        "scope": "global",
        "command": "let template = canvas.scene.collections.templates.get(args[0].templateId);\nif (!template) return;\nlet spellLevel = args[0].spellLevel;\nlet spelldc = args[0].actor.system.attributes.spelldc;\nlet damageRoll = spellLevel + 'd8';\ntemplate.setFlag('world', 'spellLevel', spellLevel);\ntemplate.setFlag('world', 'spelldc', spelldc);\nlet effectData = {\n\t'label': 'Cloudkill',\n\t'icon': 'icons/magic/air/fog-gas-smoke-swirling-green.webp',\n\t'changes': [\n\t\t{\n\t\t'key': 'flags.midi-qol.OverTime',\n\t\t'mode': 5,\n\t\t'value': 'turn=start, rollType=save, saveAbility= con, saveDamage= halfdamage, saveRemove= false, saveMagic=true, damageType= poison, damageRoll= ' + damageRoll + ', saveDC = ' + spelldc,\n\t\t'priority': 20\n\t\t}\n\t],\n\t'origin': args[0].itemUuid,\n\t'duration': {seconds: 86400},\n\t'flags': {\n\t\t'effectmacro': {\n\t\t\t'onTurnStart': {\n\t\t\t\t'script': \"let combatTurn = game.combat.round + '-' + game.combat.turn;\\nlet templateId = effect.getFlag('world', 'spell.cloudkill.id');\\nif (!templateId) return;\\ntoken.document.setFlag('world', `spell.cloudkill.${templateId}.turn`, combatTurn);\"\n\t\t\t}\n\t\t},\n\t\t'world': {\n\t\t\t'spell': {\n\t\t\t\t'cloudkill': {\n\t\t\t\t\t'id': args[0].templateId\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\nlet tokenList = [];\nfor (let i = 0; args[0].targets.length > i; i++) {\n\tif (!tokenList.includes(args[0].targets[i].id)) {\n\t\ttokenList.push(args[0].targets[i].id);\n\t\tawait MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: args[0].targets[i].actor.uuid, effects: [effectData]});\n\t}\n}\ntemplate.setFlag('world', 'tokens', tokenList);",
        "author": "Ci2oCKdswvomgIrG",
        "_id": null,
        "img": "icons/svg/dice-target.svg",
        "folder": null,
        "sort": 0,
        "ownership": {
          "default": 0
        },
        "flags": {},
        "_stats": {
          "systemId": null,
          "systemVersion": null,
          "coreVersion": null,
          "createdTime": null,
          "modifiedTime": null,
          "lastModifiedBy": null
        }
      }
    },
    "midi-qol": {
      "onUseMacroName": "[postActiveEffects]ItemMacro",
      "effectActivation": false
    },
    "custom-character-sheet-sections": {
      "sectionName": ""
    },
    "rest-recovery": {
      "data": {
        "recovery": {
          "enabled": false
        }
      }
    },
    "midiProperties": {
      "nodam": false,
      "fulldam": false,
      "halfdam": false,
      "rollOther": false,
      "critOther": false,
      "magicdam": false,
      "magiceffect": false,
      "concentration": false,
      "toggleEffect": false,
      "ignoreTotalCover": false
    },
    "enhanced-terrain-layer": {
      "multiple": null,
      "elevation": null,
      "depth": null,
      "environment": ""
    },
    "templatemacro": {
      "whenEntered": {
        "asGM": true,
        "command": "let doDamage = false;\nif (game.combat != null && game.combat != undefined) {\n\tlet combatTurn = game.combat.round + '-' + game.combat.turn;\n\tlet tokenTurn = token.document.getFlag('world', `spell.cloudkill.${template.id}.turn`);\n\tif (tokenTurn != combatTurn) doDamage = true;\n\ttoken.document.setFlag('world', `spell.cloudkill.${template.id}.turn`, combatTurn);\n}\nlet tokenList = template.flags.world.tokens || [];\nif (!tokenList.includes(token.id)) {\n\ttokenList.push(token.id);\n}\ntemplate.setFlag('world', 'tokens', tokenList);\nlet spellLevel = template.flags.world.spellLevel || 5;\nlet spelldc = template.flags.world.spelldc || 10;\nlet damageRoll = spellLevel + 'd8';\nlet effectData = {\n\t'label': 'Cloudkill',\n\t'icon': 'icons/magic/air/fog-gas-smoke-swirling-green.webp',\n\t'changes': [\n\t\t{\n\t\t'key': 'flags.midi-qol.OverTime',\n\t\t'mode': 5,\n\t\t'value': 'turn=start, rollType=save, saveAbility= con, saveDamage= halfdamage, saveRemove= false, saveMagic=true, damageType= poison, damageRoll= ' + damageRoll + ', saveDC = ' + spelldc,\n\t\t'priority': 20\n\t\t}\n\t],\n\t'origin': template.flags.dnd5e.origin,\n\t'duration': {seconds: 86400},\n\t'flags': {\n\t\t'effectmacro': {\n\t\t\t'onTurnStart': {\n\t\t\t\t'script': \"let combatTurn = game.combat.round + '-' + game.combat.turn;\\nlet templateId = effect.getFlag('world', 'spell.cloudkill.id');\\nif (!templateId) return;\\ntoken.document.setFlag('world', `spell.cloudkill.${templateId}.turn`, combatTurn);\"\n\t\t\t}\n\t\t}\n\t}\n}\nawait token.actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\nlet cloudEffect = token.actor.effects.find(eff => eff.label === 'Cloudkill');\ncloudEffect.setFlag('world', 'spell.cloudkill.id', template.id);\nif (doDamage) MidiQOL.doOverTimeEffect(token.actor, cloudEffect, true);"
      },
      "whenLeft": {
        "asGM": true,
        "command": "let effect = token.actor.effects.find(eff => eff.label === 'Cloudkill');\nif (effect) effect.delete()"
      },
      "whenDeleted": {
        "asGM": true,
        "command": "let tokenList = template.flags.world.tokens;\nif (tokenList.length === 0) return;\nfor (let i = 0; tokenList.length > i; i++) {\n\tlet tokenDoc = canvas.scene.tokens.get(tokenList[i]);\n\ttokenDoc.unsetFlag('world', 'spell.cloudkill.' + template.id);\n\tlet effect = tokenDoc.actor.effects.find(eff => eff.label === 'Cloudkill');\n\tif (effect) effect.delete()\n}"
      },
      "whenMoved": {
        "asGM": true,
        "command": "let tokensInTemplate = game.modules.get('templatemacro').api.findContained(template);\nlet tokenList = template.flags.world.tokens;\nfor (let i = 0; tokenList.length > i; i++) {\n\tif (tokensInTemplate.includes(tokenList[i])) continue;\n\tlet tokenDoc = canvas.scene.tokens.get(tokenList[i]);\n\tlet effect = tokenDoc.actor.effects.find(eff => eff.label === 'Cloudkill');\n\tif (effect) effect.delete()\n}"
      }
    },
    "favtab": {
      "isFavorite": true
    },
    "core": {
      "sourceId": "Actor.iDTsfmjce9HF9WmK.Item.ELsVomopMwIhXcWT"
    },
    "exportSource": {
      "world": "wordal",
      "system": "dnd5e",
      "coreVersion": "10.288",
      "systemVersion": "2.0.3"
    }
  },
  "effects": [
    {
      "label": "Cloudkill - Movement Handler",
      "icon": "icons/magic/air/fog-gas-smoke-swirling-green.webp",
      "changes": [],
      "transfer": false,
      "_id": "px3PouJU5iD1zz5L",
      "disabled": false,
      "duration": {
        "startTime": null,
        "seconds": null,
        "combat": null,
        "rounds": null,
        "turns": null,
        "startRound": null,
        "startTurn": null
      },
      "origin": null,
      "tint": null,
      "flags": {
        "dae": {
          "selfTarget": true,
          "selfTargetAlways": false,
          "stackable": "none",
          "durationExpression": "",
          "macroRepeat": "none",
          "specialDuration": []
        },
        "core": {
          "statusId": ""
        },
        "ActiveAuras": {
          "isAura": false,
          "aura": "None",
          "radius": null,
          "alignment": "",
          "type": "",
          "ignoreSelf": false,
          "height": false,
          "hidden": false,
          "displayTemp": false,
          "hostile": false,
          "onlyOnce": false
        }
      }
    }
  ],
  "img": "icons/magic/air/fog-gas-smoke-swirling-green.webp",
  "_stats": {
    "systemId": "dnd5e",
    "systemVersion": "2.0.3",
    "coreVersion": "10.288",
    "createdTime": 1667888110992,
    "modifiedTime": 1667992878290,
    "lastModifiedBy": "Ci2oCKdswvomgIrG"
  }
}